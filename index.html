<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Technology Expert's</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root{
      --royal:#0a33ff;
      --ink:#0b1020;
      --muted:#6b7280;
      --card:#ffffff;
      --bd:#e7e7e7;
      --danger:#b00020;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:Arial, sans-serif; background:#fff; color:var(--ink); }

    /* ===== HOME ===== */
    .home{
      min-height:100vh;
      background: radial-gradient(1200px 600px at 20% 10%, #2f58ff 0%, var(--royal) 35%, #061a6a 100%);
      color:#fff;
      padding:18px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .homeWrap{
      width:min(980px, 100%);
      display:grid;
      gap:16px;
      grid-template-columns:1fr;
      align-items:center;
    }
    @media(min-width:860px){ .homeWrap{ grid-template-columns: 1.1fr 0.9fr; } }
    .logoTitle{ font-weight:900; font-size:32px; line-height:1.1; letter-spacing:0.2px; }
    .subtitle{ opacity:.92; font-size:15px; line-height:1.4; max-width:52ch; }

    .heroCard{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 22px;
      padding: 14px;
      backdrop-filter: blur(8px);
    }
    .homeButtons{
      display:grid; gap:12px; margin-top:10px; grid-template-columns:1fr;
    }
    @media(min-width:520px){ .homeButtons{ grid-template-columns:1fr 1fr; } }
    .bigBtn{
      border:none; border-radius:18px; padding:16px 14px;
      font-size:16px; font-weight:900; cursor:pointer;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      transition: transform .08s ease;
    }
    .bigBtn:active{ transform: scale(0.99); }
    .bigBtn.light{ background:#fff; color:var(--ink); }
    .bigBtn.dark{
      background:rgba(255,255,255,.12); color:#fff;
      border:1px solid rgba(255,255,255,.22);
    }
    .chipRow{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .chip{
      font-size:12px; padding:6px 10px; border-radius:999px;
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.22);
      opacity:.95;
    }
    .heroSvg{ width:100%; height:auto; display:block; border-radius:18px; }

    /* ===== APP ===== */
    .app{ display:none; padding:16px; max-width:980px; margin:0 auto; }
    .topbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
    .btn{
      border:none; border-radius:14px; padding:12px 12px;
      font-weight:900; cursor:pointer;
      background:#111; color:#fff; flex:1; min-width:160px;
    }
    .btn.light{ background:#f2f2f2; color:#111; border:1px solid #e0e0e0; }
    .btn.danger{ background:var(--danger); }

    .pill{
      display:inline-block; padding:6px 10px; border-radius:999px;
      font-size:12px; border:1px solid #e6e6e6; background:#f7f7f7;
    }
    .pill.ok{ background:#e9f7ef; border-color:#c9efd8; }
    .pill.lock{ background:#fff3cd; border-color:#ffe69c; color:#664d03; }

    .card{ background:var(--card); border:1px solid var(--bd); border-radius:18px; padding:14px; margin-top:12px; }
    h2{ margin: 10px 0 10px; }
    .muted{ color:var(--muted); font-size:13px; }

    input, textarea, select{
      width:100%; padding:12px; font-size:16px;
      border-radius:14px; border:1px solid #d8d8d8;
      margin:8px 0; background:#fff;
    }
    textarea{ min-height:90px; resize:vertical; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > *{ flex:1; min-width:170px; }

    .tabs{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .tab{
      flex:1; min-width:180px;
      border:none; border-radius:16px; padding:12px 12px;
      font-weight:900; cursor:pointer;
      background:#f2f2f2; border:1px solid #e0e0e0;
    }
    .tab.active{ background:#111; color:#fff; border-color:#111; }

    /* Firma */
    .firma-wrap{ border:1px dashed #bdbdbd; border-radius:18px; padding:10px; background:#fafafa; }
    canvas{
      width:100%; height:180px; background:#fff;
      border-radius:14px; border:1px solid #ddd;
      touch-action:none; display:block;
    }

    .item{
      border:1px solid #ddd; border-radius:16px; padding:12px; margin-top:10px;
    }
    .itemActions{ margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; }
    .itemActions button{
      border:none; border-radius:14px; padding:10px 12px;
      font-weight:900; cursor:pointer; background:#111; color:#fff;
    }
    .itemActions .danger{ background:var(--danger); }
    .itemActions .light{ background:#f2f2f2; color:#111; border:1px solid #e0e0e0; }

    /* Modal Admin */
    .modalBg{
      position:fixed; inset:0;
      background:rgba(0,0,0,0.45);
      display:none; align-items:center; justify-content:center;
      padding:16px; z-index:9999;
    }
    .modal{
      background:#fff; width:min(520px, 100%);
      border-radius:18px; padding:14px; border:1px solid #e5e5e5;
    }
    .modal h3{ margin:6px 0 10px; }
    .warn{
      background:#fff3cd; border:1px solid #ffe69c;
      padding:10px; border-radius:14px; color:#664d03; margin-top:10px;
    }
    .smallNote{
      font-size:12px; color:#6b7280; margin-top:8px;
    }
  </style>
</head>

<body>

  <!-- ===== HOME ===== -->
  <section class="home" id="home">
    <div class="homeWrap">
      <div>
        <div class="logoTitle">Technology Expert‚Äôs</div>
        <div class="subtitle">
          Recepci√≥n de equipos + ventas. Moderno, r√°pido y sin depender de servidores externos.
          (Por ahora guarda local en este dispositivo; luego lo pasamos a PC servidor).
        </div>

        <div class="homeButtons">
          <button class="bigBtn light" onclick="entrarApp('orden')">üßæ Orden de servicio <span>‚Ä∫</span></button>
          <button class="bigBtn dark" onclick="entrarApp('venta')">üí≥ Ventas <span>‚Ä∫</span></button>
        </div>

        <div class="chipRow">
          <span class="chip">üîí Admin PIN</span>
          <span class="chip">‚úçÔ∏è Firma obligatoria (solo orden)</span>
          <span class="chip">üß† Autocompleta y aprende</span>
          <span class="chip">üì± Celular / Tablet / PC</span>
        </div>
      </div>

      <div class="heroCard">
        <svg class="heroSvg" viewBox="0 0 900 520" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Ilustraci√≥n tecnolog√≠a">
          <defs>
            <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#ffffff" stop-opacity="0.95"/>
              <stop offset="1" stop-color="#cfe0ff" stop-opacity="0.55"/>
            </linearGradient>
            <linearGradient id="g2" x1="0" x2="1" y1="1" y2="0">
              <stop offset="0" stop-color="#6ee7ff" stop-opacity="0.55"/>
              <stop offset="1" stop-color="#ffffff" stop-opacity="0.25"/>
            </linearGradient>
          </defs>
          <rect x="0" y="0" width="900" height="520" rx="26" fill="rgba(255,255,255,0.10)" />
          <circle cx="160" cy="140" r="120" fill="url(#g2)" opacity="0.9"/>
          <circle cx="700" cy="130" r="150" fill="url(#g1)" opacity="0.7"/>
          <circle cx="520" cy="400" r="170" fill="url(#g2)" opacity="0.55"/>
          <rect x="210" y="180" width="470" height="240" rx="18" fill="rgba(255,255,255,0.18)" stroke="rgba(255,255,255,0.35)"/>
          <rect x="240" y="205" width="410" height="165" rx="14" fill="rgba(0,0,0,0.18)" stroke="rgba(255,255,255,0.25)"/>
          <rect x="175" y="425" width="540" height="40" rx="18" fill="rgba(255,255,255,0.18)" stroke="rgba(255,255,255,0.30)"/>
          <rect x="95" y="260" width="95" height="180" rx="18" fill="rgba(255,255,255,0.18)" stroke="rgba(255,255,255,0.35)"/>
          <rect x="108" y="285" width="69" height="120" rx="12" fill="rgba(0,0,0,0.18)"/>
          <text x="240" y="390" fill="rgba(255,255,255,0.85)" font-size="18" font-family="Arial" font-weight="700">
            √ìrdenes ‚Ä¢ Ventas ‚Ä¢ Inventario (pr√≥ximo)
          </text>
        </svg>
      </div>
    </div>
  </section>

  <!-- ===== APP ===== -->
  <section class="app" id="app">
    <div class="topbar">
      <button class="btn light" onclick="volverInicio()">‚Üê Inicio</button>
      <span id="adminEstado" class="pill lock">üîí Bloqueado (Admin)</span>
      <button class="btn light" id="btnAdmin" onclick="abrirAdmin()">üîì Entrar como Admin</button>
      <button class="btn light" onclick="cerrarAdmin()">üîí Bloquear</button>
    </div>

    <div class="tabs">
      <button class="tab active" id="tabOrden" onclick="showPanel('orden')">üßæ Orden de servicio</button>
      <button class="tab" id="tabVenta" onclick="showPanel('venta')">üí≥ Ventas</button>
    </div>

    <!-- ===== PANEL ORDEN ===== -->
    <section id="panelOrden">
      <div class="card">
        <h2>Orden de servicio</h2>
        <div class="muted">Consecutivo inicia en <b>2100</b> y sube ascendente.</div>

        <h2>Datos del cliente</h2>
        <div class="row">
          <input id="o_cliente" placeholder="Nombre del cliente" autocomplete="name">
          <input id="o_cedula" placeholder="C√©dula" inputmode="numeric">
        </div>
        <div class="row">
          <input id="o_telefono" placeholder="Celular" inputmode="tel" autocomplete="tel">
          <div>
            <input id="o_correo" type="email" placeholder="Correo electr√≥nico" autocomplete="off" list="correoSugerencias">
            <datalist id="correoSugerencias"></datalist>
          </div>
        </div>

        <h2>Equipo</h2>
        <div class="row">
          <div>
            <input id="o_marca" placeholder="Marca del equipo" list="listaMarcas">
            <datalist id="listaMarcas"></datalist>
          </div>
          <div>
            <input id="o_modelo" placeholder="Modelo" list="listaModelos">
            <datalist id="listaModelos"></datalist>
          </div>
        </div>

        <textarea id="o_falla" placeholder="Falla reportada"></textarea>

        <h2>Firma del cliente (obligatoria)</h2>
        <div class="firma-wrap">
          <div class="muted">Firma con el dedo o mouse. Si no firma, NO se guarda.</div>
          <canvas id="firma"></canvas>

          <div class="row">
            <button class="btn light" onclick="borrarFirma()">üßΩ Borrar firma</button>
            <button class="btn" onclick="guardarOrden()">üíæ Guardar orden</button>
          </div>
        </div>

        <div class="row">
          <button class="btn light" onclick="nuevaOrden()">üÜï Nueva orden</button>
          <button class="btn danger" onclick="borrarOrdenes()">üóëÔ∏è Borrar √ìrdenes (Admin)</button>
        </div>
      </div>

      <div class="card">
        <h2>√ìrdenes guardadas</h2>
        <div id="listaOrdenes"></div>
      </div>
    </section>

    <!-- ===== PANEL VENTAS ===== -->
    <section id="panelVenta" style="display:none;">
      <div class="card">
        <h2>Ventas</h2>
        <div class="muted">Consecutivo de ventas inicia en <b>304</b> (ascendente).</div>

        <h2>Datos del cliente</h2>
        <div class="row">
          <input id="v_cliente" placeholder="Nombre del cliente">
          <input id="v_cedula" placeholder="C√©dula" inputmode="numeric">
        </div>
        <div class="row">
          <input id="v_telefono" placeholder="Celular" inputmode="tel">
          <input id="v_correo" type="email" placeholder="Correo (opcional)" autocomplete="off" list="correoSugerencias">
        </div>

        <h2>Venta</h2>
        <div class="row">
          <select id="v_categoria" onchange="onCategoriaVenta()">
            <option value="Accesorios">Accesorios</option>
            <option value="Celulares">Celulares (requiere IMEI)</option>
            <option value="PC">PC</option>
            <option value="Consolas">Consolas</option>
          </select>
          <input id="v_producto" placeholder="Producto / Descripci√≥n">
        </div>

        <div class="row">
          <input id="v_cantidad" placeholder="Cantidad" inputmode="numeric" value="1">
          <input id="v_total" placeholder="Total $" inputmode="numeric">
        </div>

        <!-- IMEI SOLO PARA CELULARES -->
        <div id="bloqueImei" style="display:none;">
          <h2>IMEI (solo venta de celulares)</h2>
          <div class="row">
            <input id="v_imei1" placeholder="IMEI 1 (obligatorio)" inputmode="numeric">
            <input id="v_imei2" placeholder="IMEI 2 (opcional)" inputmode="numeric">
          </div>
          <div class="muted">
            T√©rmino: No nos hacemos responsables si el cliente no registra los IMEI ante el operador que vaya a usar.
          </div>
        </div>

        <div class="row">
          <button class="btn" onclick="guardarVenta()">üíæ Guardar venta</button>
          <button class="btn danger" onclick="borrarVentas()">üóëÔ∏è Borrar Ventas (Admin)</button>
        </div>

        <div class="row">
          <button class="btn light" onclick="whatsappUltimaVenta()">üì≤ Compartir √∫ltima venta por WhatsApp</button>
          <button class="btn light" onclick="copiarUltimaVenta()">üìã Copiar √∫ltima venta</button>
        </div>

        <div class="smallNote">
          * Ventas NO pide firma. Solo Orden de servicio.
        </div>
      </div>

      <div class="card">
        <h2>Ventas guardadas</h2>
        <div id="listaVentas"></div>
      </div>
    </section>
  </section>

  <!-- ===== MODAL ADMIN ===== -->
  <div class="modalBg" id="modalBg">
    <div class="modal">
      <h3 id="modalTitulo">Admin</h3>
      <div class="muted" id="modalHint"></div>

      <div id="bloqueSetPin" style="display:none;">
        <div class="warn">No hay PIN configurado. Crea uno (6 d√≠gitos) y gu√°rdalo bien.</div>
        <input id="pinNuevo1" placeholder="Crear PIN (6 d√≠gitos)" inputmode="numeric" maxlength="6">
        <input id="pinNuevo2" placeholder="Repetir PIN" inputmode="numeric" maxlength="6">
        <button class="btn" onclick="confirmarSetPin()">Guardar PIN</button>
      </div>

      <div id="bloqueLogin" style="display:none;">
        <input id="pinLogin" placeholder="PIN Admin (6 d√≠gitos)" inputmode="numeric" maxlength="6">
        <button class="btn" onclick="confirmarLogin()">Entrar</button>
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="btn light" onclick="cerrarModal()">Cancelar</button>
      </div>
      <div class="smallNote">
        Admin protege borrar/eliminar. En PC lo haremos con usuarios reales.
      </div>
    </div>
  </div>

<script>
/* ===== HOME / APP ===== */
function entrarApp(tab){
  document.getElementById("home").style.display = "none";
  document.getElementById("app").style.display = "block";
  showPanel(tab);
}
function volverInicio(){
  document.getElementById("app").style.display = "none";
  document.getElementById("home").style.display = "flex";
}
function showPanel(which){
  const isOrden = which === "orden";
  document.getElementById("panelOrden").style.display = isOrden ? "" : "none";
  document.getElementById("panelVenta").style.display = isOrden ? "none" : "";
  document.getElementById("tabOrden").classList.toggle("active", isOrden);
  document.getElementById("tabVenta").classList.toggle("active", !isOrden);
}

/* ===== STORAGE ===== */
let ordenes = JSON.parse(localStorage.getItem("ordenes")) || [];
let ventas = JSON.parse(localStorage.getItem("ventas")) || [];
let consecutivoOrden = Number(localStorage.getItem("consecutivoOrden")) || 2100;
let consecutivoVenta = Number(localStorage.getItem("consecutivoVenta")) || 304;

/* ===== ADMIN PIN ===== */
const K_ADMIN_HASH = "te_admin_pin_hash_v1";
const K_ADMIN_SALT = "te_admin_pin_salt_v1";
const K_ADMIN_SESSION = "te_admin_session_until_v1";
function nowMs(){ return Date.now(); }
function adminActivo(){
  const until = Number(localStorage.getItem(K_ADMIN_SESSION) || 0);
  return until > nowMs();
}
function setAdminSesion(min){ localStorage.setItem(K_ADMIN_SESSION, String(nowMs() + min*60*1000)); refrescarAdminUI(); }
function limpiarSesionAdmin(){ localStorage.setItem(K_ADMIN_SESSION, "0"); refrescarAdminUI(); }
function tienePin(){ return !!localStorage.getItem(K_ADMIN_HASH) && !!localStorage.getItem(K_ADMIN_SALT); }
function pinValidoFormato(pin){ return /^\d{6}$/.test(pin); }
function randomSalt(){
  const a = new Uint8Array(16);
  crypto.getRandomValues(a);
  return Array.from(a).map(b=>b.toString(16).padStart(2,"0")).join("");
}
async function sha256Hex(text){
  const enc = new TextEncoder().encode(text);
  const buf = await crypto.subtle.digest("SHA-256", enc);
  const arr = Array.from(new Uint8Array(buf));
  return arr.map(b=>b.toString(16).padStart(2,"0")).join("");
}
async function hashPin(pin){
  const salt = localStorage.getItem(K_ADMIN_SALT) || "";
  return sha256Hex(salt + ":" + pin);
}
function refrescarAdminUI(){
  const estado = document.getElementById("adminEstado");
  const btn = document.getElementById("btnAdmin");
  if(adminActivo()){
    estado.textContent = "‚úÖ Admin activo";
    estado.classList.remove("lock"); estado.classList.add("ok");
    btn.textContent = "‚úÖ Admin activo (reingresar)";
  } else {
    estado.textContent = "üîí Bloqueado (Admin)";
    estado.classList.remove("ok"); estado.classList.add("lock");
    btn.textContent = "üîì Entrar como Admin";
  }
}
function abrirAdmin(){
  const modalBg = document.getElementById("modalBg");
  const setPin = document.getElementById("bloqueSetPin");
  const login = document.getElementById("bloqueLogin");
  const titulo = document.getElementById("modalTitulo");
  const hint = document.getElementById("modalHint");

  document.getElementById("pinNuevo1").value = "";
  document.getElementById("pinNuevo2").value = "";
  document.getElementById("pinLogin").value = "";

  if(!tienePin()){
    titulo.textContent = "Crear PIN de Admin";
    hint.textContent = "Este PIN protege borrar/eliminar. Debe ser de 6 d√≠gitos.";
    setPin.style.display = ""; login.style.display = "none";
  } else {
    titulo.textContent = "Entrar como Admin";
    hint.textContent = "Ingresa tu PIN de 6 d√≠gitos.";
    setPin.style.display = "none"; login.style.display = "";
  }
  modalBg.style.display = "flex";
}
function cerrarModal(){ document.getElementById("modalBg").style.display = "none"; }
async function confirmarSetPin(){
  const p1 = document.getElementById("pinNuevo1").value.trim();
  const p2 = document.getElementById("pinNuevo2").value.trim();
  if(!pinValidoFormato(p1)) return alert("PIN: exactamente 6 d√≠gitos.");
  if(p1 !== p2) return alert("Los PIN no coinciden.");
  const salt = randomSalt();
  localStorage.setItem(K_ADMIN_SALT, salt);
  localStorage.setItem(K_ADMIN_HASH, await sha256Hex(salt + ":" + p1));
  setAdminSesion(60);
  cerrarModal();
  alert("PIN creado y Admin activo ‚úÖ");
}
async function confirmarLogin(){
  const pin = document.getElementById("pinLogin").value.trim();
  if(!pinValidoFormato(pin)) return alert("PIN inv√°lido (6 d√≠gitos).");
  const expected = localStorage.getItem(K_ADMIN_HASH);
  const got = await hashPin(pin);
  if(got !== expected) return alert("PIN incorrecto.");
  setAdminSesion(60);
  cerrarModal();
  alert("Admin activo ‚úÖ");
}
function cerrarAdmin(){ limpiarSesionAdmin(); alert("Bloqueado üîí"); }
async function requireAdmin(){
  if(adminActivo()) return true;
  abrirAdmin();
  alert("Acci√≥n protegida: entra como Admin.");
  return false;
}

/* ===== FIRMA (solo ORDEN) ===== */
const canvas = document.getElementById("firma");
const ctx = canvas.getContext("2d");
let firmando = false;
let hayFirma = false;

function ajustarCanvas(){
  const r = canvas.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;
  canvas.width = Math.floor(r.width * dpr);
  canvas.height = Math.floor(180 * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.lineJoin = "round";
  ctx.strokeStyle = "#111";
}
function getPos(e){
  const r = canvas.getBoundingClientRect();
  return { x: e.c

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Technology Expertâ€™s</title>

  <style>
    :root{
      --royal:#0a33ff;
      --royal2:#0626c9;
      --bg:#0b1020;
      --card:#ffffff;
      --bd:#e7e7e7;
      --muted:#6b7280;
      --danger:#b00020;
      --ok:#0f9d58;
      --warn:#fff3cd;
      --warnBd:#ffe69c;
      --blue:#1b6cff; /* listo */
      --yellow:#ffd54f; /* recibido */
      --gray:#e9ecef;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:Arial, sans-serif; background:#fff; color:#0b1020; }
    a{ color:inherit; }

    /* HOME */
    .home{
      min-height:100vh;
      background: radial-gradient(1200px 600px at 20% 10%, #2f58ff 0%, var(--royal) 35%, #061a6a 100%);
      color:#fff;
      padding:18px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .homeWrap{
      width:min(1040px, 100%);
      display:grid;
      gap:16px;
      grid-template-columns:1fr;
      align-items:center;
    }
    @media(min-width:900px){ .homeWrap{ grid-template-columns:1.1fr 0.9fr; } }
    .logoTitle{ font-weight:900; font-size:34px; letter-spacing:.2px; line-height:1.08; }
    .subtitle{ opacity:.92; font-size:15px; line-height:1.45; max-width:56ch; }
    .homeButtons{ display:grid; gap:12px; margin-top:12px; grid-template-columns:1fr; }
    @media(min-width:520px){ .homeButtons{ grid-template-columns:1fr 1fr; } }
    .bigBtn{
      border:none;
      border-radius:18px;
      padding:16px 14px;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      transition:transform .08s ease;
    }
    .bigBtn:active{ transform:scale(0.99); }
    .bigBtn.light{ background:#fff; color:#0b1020; }
    .bigBtn.dark{
      background:rgba(255,255,255,.12);
      color:#fff;
      border:1px solid rgba(255,255,255,.22);
    }
    .chipRow{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    .chip{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.22);
    }
    .heroCard{
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      border-radius:22px;
      padding:14px;
      backdrop-filter: blur(8px);
    }
    .heroSvg{ width:100%; height:auto; display:block; border-radius:18px; }

    /* APP */
    .app{ display:none; padding:16px; max-width:1100px; margin:0 auto; }
    .topbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
    .btn{
      border:none; border-radius:14px; padding:12px 12px;
      font-weight:900; cursor:pointer;
      background:#111; color:#fff;
      min-width:160px;
    }
    .btn.light{ background:#f2f2f2; color:#111; border:1px solid #e0e0e0; }
    .btn.danger{ background:var(--danger); }
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid #e6e6e6;
      background:#f7f7f7;
    }
    .pill.ok{ background:#e9f7ef; border-color:#c9efd8; }
    .pill.lock{ background:var(--warn); border-color:var(--warnBd); color:#664d03; }

    .tabs{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .tab{
      flex:1; min-width:160px;
      border:none; border-radius:16px;
      padding:12px 12px;
      font-weight:900;
      cursor:pointer;
      background:#f2f2f2;
      border:1px solid #e0e0e0;
    }
    .tab.active{ background:#111; color:#fff; border-color:#111; }

    .card{
      background:var(--card);
      border:1px solid var(--bd);
      border-radius:18px;
      padding:14px;
      margin-top:12px;
    }
    h2{ margin:10px 0 10px; }
    .muted{ color:var(--muted); font-size:13px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > *{ flex:1; min-width:180px; }

    input, textarea, select{
      width:100%;
      padding:12px;
      font-size:16px;
      border-radius:14px;
      border:1px solid #d8d8d8;
      margin:8px 0;
      background:#fff;
    }
    textarea{ min-height:90px; resize:vertical; }

    /* Signature */
    .firma-wrap{ border:1px dashed #bdbdbd; border-radius:18px; padding:10px; background:#fafafa; }
    canvas.sig{
      width:100%; height:180px;
      background:#fff;
      border-radius:14px;
      border:1px solid #ddd;
      touch-action:none;
      display:block;
    }

    /* Lists */
    .item{
      border:1px solid #ddd;
      border-radius:16px;
      padding:12px;
      margin-top:10px;
    }
    .itemActions{ margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; }
    .itemActions button{
      border:none;
      border-radius:14px;
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
      background:#111;
      color:#fff;
    }
    .itemActions .danger{ background:var(--danger); }
    .itemActions .light{ background:#f2f2f2; color:#111; border:1px solid #e0e0e0; }

    /* Status badge */
    .badge{ display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; font-weight:900; }
    .b1{ background:var(--yellow); }
    .b3{ background:rgba(27,108,255,.16); color:#0b3aa3; border:1px solid rgba(27,108,255,.25); }
    .b2{ background:#ffe8cc; }
    .b4{ background:#d3f9d8; }
    .b9{ background:#ffd6d6; }

    /* Inventory search list */
    .suggestBox{
      border:1px solid #e0e0e0;
      border-radius:14px;
      overflow:hidden;
      background:#fff;
      margin-top:-4px;
    }
    .suggestItem{
      padding:10px 12px;
      border-top:1px solid #eee;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      cursor:pointer;
    }
    .suggestItem:first-child{ border-top:none; }
    .suggestItem.active{ background:#f2f6ff; }
    .sLeft{ display:flex; align-items:center; gap:10px; min-width:0; }
    .thumb{
      width:40px; height:40px; border-radius:12px; background:#f2f2f2;
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
      flex:0 0 auto;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .sName{ font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:52vw; }
    .sMeta{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .sPrice{ font-weight:900; }

    .lowStock{ border:1px solid #ffe69c; background:#fff3cd; }
    .dangerText{ color:var(--danger); font-weight:900; }

    /* QR area */
    .qrWrap{ display:flex; gap:12px; flex-wrap:wrap; align-items:flex-start; }
    .qrBox{ border:1px solid #e0e0e0; border-radius:16px; padding:12px; background:#fff; }
    #qrCanvas{ width:220px; height:220px; image-rendering:pixelated; }
    video{ width:100%; border-radius:16px; border:1px solid #e0e0e0; background:#000; }

    /* Print */
    @media print{
      body{ margin:0; }
      .noPrint{ display:none !important; }
      .printArea{ padding:12px; font-size:12px; }
      .printArea h1{ font-size:16px; margin:0 0 6px; }
      .printArea .line{ margin:4px 0; }
      .printArea .small{ font-size:11px; color:#333; }
    }
  </style>
</head>
<body>

<!-- HOME -->
<section class="home" id="home">
  <div class="homeWrap">
    <div>
      <div class="logoTitle">Technology Expertâ€™s</div>
      <div class="subtitle">
        Ã“rdenes de servicio + ventas + inventario + etiquetas QR. Sin servidores (por ahora). Admin con PIN.
      </div>

      <div class="homeButtons">
        <button class="bigBtn light" onclick="enterApp('orden')">ğŸ§¾ Orden de servicio <span>â€º</span></button>
        <button class="bigBtn dark" onclick="enterApp('ventas')">ğŸ’³ Ventas <span>â€º</span></button>
      </div>

      <div class="chipRow">
        <span class="chip">ğŸ”’ Admin PIN</span>
        <span class="chip">âœï¸ Firma obligatoria (orden)</span>
        <span class="chip">ğŸ“· Fotos</span>
        <span class="chip">ğŸ“¦ Inventario + alerta</span>
        <span class="chip">ğŸ·ï¸ QR etiquetas</span>
        <span class="chip">ğŸ§  Autocompleta y aprende</span>
      </div>
    </div>

    <div class="heroCard">
      <svg class="heroSvg" viewBox="0 0 900 520" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="IlustraciÃ³n tecnologÃ­a">
        <defs>
          <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#ffffff" stop-opacity="0.95"/>
            <stop offset="1" stop-color="#cfe0ff" stop-opacity="0.55"/>
          </linearGradient>
          <linearGradient id="g2" x1="0" x2="1" y1="1" y2="0">
            <stop offset="0" stop-color="#6ee7ff" stop-opacity="0.55"/>
            <stop offset="1" stop-color="#ffffff" stop-opacity="0.25"/>
          </linearGradient>
        </defs>
        <rect x="0" y="0" width="900" height="520" rx="26" fill="rgba(255,255,255,0.10)" />
        <circle cx="160" cy="140" r="120" fill="url(#g2)" opacity="0.9"/>
        <circle cx="700" cy="130" r="150" fill="url(#g1)" opacity="0.7"/>
        <circle cx="520" cy="400" r="170" fill="url(#g2)" opacity="0.55"/>
        <rect x="210" y="180" width="470" height="240" rx="18" fill="rgba(255,255,255,0.18)" stroke="rgba(255,255,255,0.35)"/>
        <rect x="240" y="205" width="410" height="165" rx="14" fill="rgba(0,0,0,0.18)" stroke="rgba(255,255,255,0.25)"/>
        <rect x="175" y="425" width="540" height="40" rx="18" fill="rgba(255,255,255,0.18)" stroke="rgba(255,255,255,0.30)"/>
        <text x="240" y="390" fill="rgba(255,255,255,0.85)" font-size="18" font-family="Arial" font-weight="700">
          Ã“rdenes â€¢ Ventas â€¢ Inventario â€¢ QR â€¢ Backups
        </text>
      </svg>
    </div>
  </div>
</section>

<!-- APP -->
<section class="app" id="app">
  <div class="topbar noPrint">
    <button class="btn light" onclick="goHome()">â† Inicio</button>
    <span id="adminState" class="pill lock">ğŸ”’ Bloqueado (Admin)</span>
    <button class="btn light" id="btnAdmin" onclick="openAdmin()">ğŸ”“ Admin</button>
    <button class="btn light" onclick="lockAdmin()">ğŸ”’ Bloquear</button>
  </div>

  <div class="tabs noPrint">
    <button class="tab active" id="tabOrden" onclick="showTab('orden')">ğŸ§¾ Orden</button>
    <button class="tab" id="tabVentas" onclick="showTab('ventas')">ğŸ’³ Ventas</button>
    <button class="tab" id="tabInv" onclick="showTab('inventario')">ğŸ“¦ Inventario</button>
    <button class="tab" id="tabQR" onclick="showTab('qr')">ğŸ·ï¸ QR</button>
    <button class="tab" id="tabBackup" onclick="showTab('backup')">ğŸ’¾ Backup</button>
  </div>

  <!-- ORDEN -->
  <section id="panelOrden">
    <div class="card noPrint">
      <h2>Orden de servicio</h2>
      <div class="muted">Consecutivo: inicia en <b>2100</b>. Firma obligatoria. Fotos guardadas en la orden.</div>

      <h2>Cliente</h2>
      <div class="row">
        <input id="o_cliente" placeholder="Nombre del cliente">
        <input id="o_cedula" placeholder="CÃ©dula" inputmode="numeric">
      </div>
      <div class="row">
        <input id="o_telefono" placeholder="Celular" inputmode="tel">
        <div>
          <input id="o_correo" placeholder="Correo" type="email" autocomplete="off" list="correoSugs">
          <datalist id="correoSugs"></datalist>
        </div>
      </div>

      <h2>Equipo</h2>
      <div class="row">
        <select id="o_tipo" onchange="onTipoOrden()">
          <option value="Celular">Celular</option>
          <option value="PC">PC</option>
          <option value="Consola">Consola</option>
        </select>

        <select id="o_subtipo" style="display:none;"></select>
      </div>

      <div class="row">
        <input id="o_marca" placeholder="Marca" list="listaMarcas">
        <datalist id="listaMarcas"></datalist>

        <input id="o_modelo" placeholder="Modelo" list="listaModelos">
        <datalist id="listaModelos"></datalist>
      </div>

      <div class="row">
        <input id="o_imei1" placeholder="IMEI 1 (opcional si llega apagado)" inputmode="numeric">
        <input id="o_imei2" placeholder="IMEI 2 (opcional)" inputmode="numeric">
      </div>

      <div class="row">
        <input id="o_dano" placeholder="DaÃ±o destacado (fisura, cÃ¡mara, face id, no carga, etc.)">
        <input id="o_pin" placeholder="PIN / PatrÃ³n / Clave (si aplica)">
      </div>

      <textarea id="o_notas" placeholder="Notas adicionales"></textarea>

      <h2>Checklist (puede omitirse si estÃ¡ â€œApagadoâ€)</h2>
      <div class="row">
        <label style="display:flex;gap:10px;align-items:center;margin:8px 0;">
          <input type="checkbox" id="o_apagado" onchange="onApagado()" style="width:auto;transform:scale(1.2);">
          <b>Apagado</b> (permite guardar sin validar checklist)
        </label>
      </div>
      <div id="checklistBox" class="row"></div>

      <h2>Estado</h2>
      <div class="row">
        <select id="o_estado">
          <option value="1">1 Recibido</option>
          <option value="2">2 En reparaciÃ³n</option>
          <option value="3">3 Listo para entrega</option>
          <option value="4">4 Entregado</option>
          <option value="9">9 Abandonado</option>
        </select>
        <input id="o_fechaEstado" type="date">
      </div>

      <h2>Fotos (para garantÃ­a)</h2>
      <input id="o_fotos" type="file" accept="image/*" multiple capture="environment">
      <div class="muted">* Consejo: muchas fotos muy pesadas pueden llenar el almacenamiento del navegador.</div>

      <h2>Firma (obligatoria)</h2>
      <div class="firma-wrap">
        <div class="muted">Firma con el dedo/mouse. Sin firma no guarda.</div>
        <canvas class="sig" id="sig"></canvas>
        <div class="row">
          <button class="btn light" onclick="sigClear()">ğŸ§½ Borrar firma</button>
          <button class="btn" onclick="saveOrder()">ğŸ’¾ Guardar orden</button>
        </div>
      </div>

      <div class="row">
        <button class="btn light" onclick="newOrder()">ğŸ†• Nueva</button>
        <button class="btn light" onclick="printLastOrder()">ğŸ–¨ï¸ Imprimir Ãºltima orden</button>
        <button class="btn danger" onclick="adminOnly(clearOrders)">ğŸ—‘ï¸ Borrar Ã³rdenes (Admin)</button>
      </div>
    </div>

    <div class="card noPrint">
      <h2>Ã“rdenes</h2>
      <div id="ordersList"></div>
    </div>
  </section>

  <!-- VENTAS -->
  <section id="panelVentas" style="display:none;">
    <div class="card noPrint">
      <h2>Ventas</h2>
      <div class="muted">Consecutivo inicia en <b>304</b>. Sin firma.</div>

      <h2>Cliente</h2>
      <div class="row">
        <input id="v_cliente" placeholder="Nombre cliente">
        <input id="v_cedula" placeholder="CÃ©dula" inputmode="numeric">
      </div>
      <div class="row">
        <input id="v_telefono" placeholder="Celular" inputmode="tel">
        <input id="v_correo" placeholder="Correo (opcional)" type="email" autocomplete="off" list="correoSugs">
      </div>

      <h2>Venta</h2>
      <div class="row">
        <select id="v_categoria" onchange="onSaleCategory()">
          <option value="Accesorios">Accesorios</option>
          <option value="Celulares">Celulares</option>
          <option value="PC">PC</option>
          <option value="Consolas">Consolas</option>
        </select>
        <select id="v_pago">
          <option value="Efectivo">Efectivo</option>
          <option value="Transferencia">Transferencia</option>
          <option value="Tarjeta">Tarjeta</option>
        </select>
      </div>

      <h2>Buscar producto (inventario)</h2>
      <input id="prodSearch" placeholder="Escribe para buscar... (Enter para seleccionar)" oninput="updateSuggestions()" onkeydown="suggestKey(event)">
      <div id="suggestions" class="suggestBox" style="display:none;"></div>

      <div class="row">
        <button class="btn light" onclick="openScanner()">ğŸ“· Leer QR (producto)</button>
        <input id="scanManual" placeholder="CÃ³digo QR manual (pegar)" onkeydown="if(event.key==='Enter'){addByQRManual();}">
      </div>

      <h2>Carrito</h2>
      <div id="cart"></div>

      <div class="row">
        <input id="v_desc" placeholder="DescripciÃ³n adicional (opcional)">
        <input id="v_totalManual" placeholder="Total manual (opcional si no usas inventario)" inputmode="numeric">
      </div>

      <div id="imeiBox" style="display:none;">
        <h2>IMEI (solo venta de celulares)</h2>
        <div class="row">
          <input id="v_imei1" placeholder="IMEI 1 (obligatorio)" inputmode="numeric">
          <input id="v_imei2" placeholder="IMEI 2 (opcional)" inputmode="numeric">
        </div>
        <div class="muted">TÃ©rmino: no respondemos si el cliente no registra los IMEI ante el operador.</div>
      </div>

      <div class="row">
        <button class="btn" onclick="finalizeSale()">âœ… Finalizar venta</button>
        <button class="btn light" onclick="printLastSale()">ğŸ–¨ï¸ Imprimir Ãºltima venta</button>
        <button class="btn light" onclick="waLastSale()">ğŸ“² WhatsApp Ãºltima venta</button>
        <button class="btn danger" onclick="adminOnly(clearSales)">ğŸ—‘ï¸ Borrar ventas (Admin)</button>
      </div>
    </div>

    <div class="card noPrint">
      <h2>Ventas guardadas</h2>
      <div id="salesList"></div>
    </div>
  </section>

  <!-- INVENTARIO -->
  <section id="panelInv" style="display:none;">
    <div class="card noPrint">
      <h2>Inventario</h2>
      <div class="muted">Costo solo Admin. Alerta visual cuando quede 1 unidad.</div>

      <div class="row">
        <input id="p_nombre" placeholder="Nombre producto (ej: Forro iPhone 11)">
        <input id="p_precio" placeholder="Precio" inputmode="numeric">
      </div>
      <div class="row">
        <input id="p_stock" placeholder="Stock" inputmode="numeric" value="1">
        <input id="p_costo" placeholder="Costo (solo Admin)" inputmode="numeric">
      </div>
      <div class="row">
        <select id="p_cat">
          <option value="Celulares">Celulares</option>
          <option value="PC">PC</option>
          <option value="Consolas">Consolas</option>
          <option value="Accesorios">Accesorios</option>
        </select>
        <input id="p_subcat" placeholder="SubcategorÃ­a (cables, cargadores, memorias, etc.)">
      </div>
      <input id="p_foto" type="file" accept="image/*" capture="environment">

      <div class="row">
        <button class="btn" onclick="saveProduct()">ğŸ’¾ Guardar producto</button>
        <button class="btn light" onclick="newProduct()">ğŸ†• Nuevo</button>
        <button class="btn light" onclick="printLabel()">ğŸ·ï¸ Imprimir etiqueta (QR)</button>
        <button class="btn danger" onclick="adminOnly(clearProducts)">ğŸ—‘ï¸ Borrar inventario (Admin)</button>
      </div>

      <div class="muted">Tip: para usarlo en ventas, crea productos aquÃ­ y luego bÃºscalos en Ventas.</div>
    </div>

    <div class="card noPrint">
      <h2>Lista de productos</h2>
      <input id="invFilter" placeholder="Filtrar..." oninput="renderProducts()">
      <div id="productsList"></div>
    </div>
  </section>

  <!-- QR -->
  <section id="panelQR" style="display:none;">
    <div class="card noPrint">
      <h2>QR</h2>
      <div class="muted">Genera QR de producto (para etiqueta) y lee QR con cÃ¡mara si el navegador soporta.</div>

      <div class="row">
        <input id="qr_text" placeholder="Texto/ID a codificar (ej: PROD:abc123)">
        <button class="btn" onclick="makeQR()">Generar QR</button>
      </div>

      <div class="qrWrap">
        <div class="qrBox">
          <canvas id="qrCanvas" width="220" height="220"></canvas>
          <div class="row" style="margin-top:10px;">
            <button class="btn light" onclick="window.print()">ğŸ–¨ï¸ Imprimir</button>
            <button class="btn light" onclick="copyQRText()">ğŸ“‹ Copiar texto</button>
          </div>
        </div>

        <div class="qrBox" style="flex:1; min-width:280px;">
          <div clas
